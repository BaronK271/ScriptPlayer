<Window x:Class="ScriptPlayer.Dialogs.SettingsDialog"
        xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
        xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
        xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
        xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
        xmlns:controls="clr-namespace:ScriptPlayer.Shared.Controls;assembly=ScriptPlayer.Shared"
        xmlns:converters="clr-namespace:ScriptPlayer.Converters"
        xmlns:converters1="clr-namespace:ScriptPlayer.Shared.Converters;assembly=ScriptPlayer.Shared"
        xmlns:shared="clr-namespace:ScriptPlayer.Shared;assembly=ScriptPlayer.Shared"
        xmlns:viewModels="clr-namespace:ScriptPlayer.ViewModels"
        mc:Ignorable="d" DataContext="{Binding RelativeSource={RelativeSource Self}}"
        WindowStartupLocation="CenterOwner"
        WindowStyle="ToolWindow" Loaded="SettingsDialog_OnLoaded"
        Title="Settings" Height="492.373" Width="670.797">
    <Window.Resources>
        <converters:TimeLeftConverter x:Key="TimeLeftConverter"/>
        <converters1:ConversionModeToNameConverter x:Key="ConversionConverter"/>
        <converters:DistinctValueToBooleanConverter x:Key="BooleanConverter"/>
        <converters:TimeSpanToMillisecondsConverter x:Key="MillisecondsConverter"/>
        <converters1:BooleanInverter x:Key="Inverter"/>
        <BooleanToVisibilityConverter x:Key="VisibilityConverter"/>

        <Style TargetType="TextBlock" x:Key="SettingName">
            <Setter Property="Margin" Value="0"/>
            <Setter Property="DockPanel.Dock" Value="Left"/>
            <Setter Property="Width" Value="120"/>
            <Setter Property="VerticalAlignment" Value="Center"/>
            <Setter Property="TextAlignment" Value="Left"/>
        </Style>

        <Style TargetType="TextBlock" x:Key="SettingValue">
            <Setter Property="Margin" Value="0"/>
            <Setter Property="DockPanel.Dock" Value="Right"/>
            <Setter Property="Width" Value="50"/>
            <Setter Property="VerticalAlignment" Value="Center"/>
            <Setter Property="TextAlignment" Value="Right"/>
        </Style>
    </Window.Resources>
    <Grid>
        <Grid.RowDefinitions>
            <RowDefinition Height="*"/>
            <RowDefinition Height="Auto"/>
        </Grid.RowDefinitions>
        <Grid Grid.Row="0" Background="#ffeeeeee">
            <Grid.ColumnDefinitions>
                <ColumnDefinition Width="200"/>
                <ColumnDefinition Width="10"/>
                <ColumnDefinition Width="*"/>
            </Grid.ColumnDefinitions>

            <TreeView Grid.Column="0" Grid.Row="0" Margin="10,10,0,10" ItemsSource="{Binding Pages}" SelectedItemChanged="TreeView_OnSelectedItemChanged">
                <TreeView.ItemContainerStyle>
                    <Style TargetType="TreeViewItem">
                        <Setter Property="IsExpanded" Value="True"/>
                    </Style>
                </TreeView.ItemContainerStyle>
                <TreeView.ItemTemplate>
                    <HierarchicalDataTemplate ItemsSource="{Binding SubSettings}">
                        <StackPanel Orientation="Horizontal">
                            <!--<Image Width="16" Height="16" Source="{Binding Icon}" Margin="1,1,8,1"/>-->
                            <TextBlock Text="{Binding Name}"/>
                        </StackPanel>
                    </HierarchicalDataTemplate>
                </TreeView.ItemTemplate>
            </TreeView>

            <GridSplitter HorizontalAlignment="Stretch" VerticalAlignment="Stretch" Grid.Row="0" Grid.Column="1"/>

            <controls:PageSelector x:Name="PageSelector" Grid.Column="2" Grid.Row="0" Margin="0,31,10,10" ActiveContentIdentifier="{Binding SelectedPage.SettingsId}">
                <controls:PageSelector.Template>
                    <ControlTemplate TargetType="{x:Type controls:PageSelector}">
                        <ScrollViewer>
                            <ContentPresenter ContentSource="Content"/>
                        </ScrollViewer>
                    </ControlTemplate>
                </controls:PageSelector.Template>
                <controls:PageSelector.Elements>
                    <Grid controls:PageSelector.ContentIdentifier="General">
                        <CheckBox IsChecked="{Binding Settings.CheckForNewVersionOnStartup}" Content="Check for new version on startup"/>
                    </Grid>
                    <Grid controls:PageSelector.ContentIdentifier="External Programs/Whirligig">
                        <TextBlock HorizontalAlignment="Left" Margin="10,11,0,0" TextWrapping="Wrap" Text="IP : Port" VerticalAlignment="Top"/>
                        <TextBox Text="{Binding Settings.WhirligigEndpoint}" Height="23" Margin="81,10,10,0" VerticalAlignment="Top"/>
                    </Grid>
                    <Grid controls:PageSelector.ContentIdentifier="External Programs/Buttplug">
                        <TextBlock HorizontalAlignment="Left" Margin="10,11,0,0" TextWrapping="Wrap" Text="WS URL" VerticalAlignment="Top"/>
                        <TextBox Text="{Binding Settings.ButtplugUrl}" Height="23" Margin="81,10,10,0" VerticalAlignment="Top"/>
                    </Grid>
                    <Grid controls:PageSelector.ContentIdentifier="External Programs/VLC">
                        <TextBlock HorizontalAlignment="Left" Margin="10,11,0,0" TextWrapping="Wrap" Text="IP : Port" VerticalAlignment="Top"/>
                        <TextBox Text="{Binding Settings.VlcEndpoint}" Height="23" Margin="81,10,10,0" VerticalAlignment="Top"/>

                        <TextBlock HorizontalAlignment="Left" Margin="10,39,0,0" TextWrapping="Wrap" Text="Password" VerticalAlignment="Top"/>
                        <PasswordBox x:Name="txtPasswordVlcPassword" PasswordChanged="TxtPasswordVlcPassword_OnPasswordChanged" Height="23" Margin="81,38,10,0" VerticalAlignment="Top"/>
                    </Grid>
                    <Grid controls:PageSelector.ContentIdentifier="Interaction/Range">
                        <StackPanel>
                            <DockPanel Margin="4" ToolTip="Minimum and maximum position of the Launch. Values received from the script will be scaled accordingly.">
                                <TextBlock Style="{StaticResource SettingName}" Text="Range"/>
                                <TextBlock Style="{StaticResource SettingValue}">
                                    <TextBlock.Text>
                                        <MultiBinding StringFormat="{}{0} - {1}">
                                            <Binding Path="Settings.MinPosition"/>
                                            <Binding Path="Settings.MaxPosition"/>
                                        </MultiBinding>
                                    </TextBlock.Text>
                                </TextBlock>

                                <shared:RangeSlider Margin="0,4" Minimum="0" Maximum="99" LowerValue="{Binding Settings.MinPosition, Mode=TwoWay}" UpperValue="{Binding Settings.MaxPosition, Mode=TwoWay}"/>
                            </DockPanel>

                            <DockPanel>
                                <TextBlock Style="{StaticResource SettingName}" Text="Range Filter"/>
                                <Grid>
                                    <Grid.Resources>
                                        <Style TargetType="{x:Type RadioButton}" BasedOn="{StaticResource {x:Static ToolBar.RadioButtonStyleKey}}">
                                            <Setter Property="HorizontalAlignment" Value="Stretch"></Setter>
                                        </Style>
                                    </Grid.Resources>
                                    <Grid.RowDefinitions>
                                        <RowDefinition Height="*"/>
                                        <RowDefinition Height="*"/>
                                        <RowDefinition Height="*"/>
                                        <RowDefinition Height="*"/>
                                        <RowDefinition Height="*"/>
                                        <RowDefinition Height="*"/>
                                    </Grid.RowDefinitions>
                                    <RadioButton Grid.Row="0" HorizontalAlignment="Stretch" IsChecked="{Binding Path=Settings.FilterMode, Converter={StaticResource BooleanConverter}, ConverterParameter={x:Static viewModels:PositionFilterMode.FullRange}}" Content="Full Range" />
                                    <RadioButton Grid.Row="1" HorizontalAlignment="Stretch" IsChecked="{Binding Path=Settings.FilterMode, Converter={StaticResource BooleanConverter}, ConverterParameter={x:Static viewModels:PositionFilterMode.Top}}" Content="Top" />
                                    <RadioButton Grid.Row="2" HorizontalAlignment="Stretch" IsChecked="{Binding Path=Settings.FilterMode, Converter={StaticResource BooleanConverter}, ConverterParameter={x:Static viewModels:PositionFilterMode.Middle}}" Content="Middle" />
                                    <RadioButton Grid.Row="3" HorizontalAlignment="Stretch" IsChecked="{Binding Path=Settings.FilterMode, Converter={StaticResource BooleanConverter}, ConverterParameter={x:Static viewModels:PositionFilterMode.Bottom}}" Content="Bottom" />
                                    <RadioButton Grid.Row="4" HorizontalAlignment="Stretch" IsChecked="{Binding Path=Settings.FilterMode, Converter={StaticResource BooleanConverter}, ConverterParameter={x:Static viewModels:PositionFilterMode.SineWave}}" Content="Sine Wave" />
                                    <RadioButton Grid.Row="5" HorizontalAlignment="Stretch" IsChecked="{Binding Path=Settings.FilterMode, Converter={StaticResource BooleanConverter}, ConverterParameter={x:Static viewModels:PositionFilterMode.TopBottom}}" Content="Top / Bottom" />
                                </Grid>
                            </DockPanel>
                            <DockPanel>
                                <TextBlock Style="{StaticResource SettingName}" Text="Filter Range"/>
                                <TextBlock Style="{StaticResource SettingValue}" Text="{Binding Settings.FilterRange, StringFormat={}{0:p0}}" />
                                <Slider Margin="0,4" Minimum="0.1" Maximum="0.9" Value="{Binding Settings.FilterRange}"/>
                            </DockPanel>

                        </StackPanel>
                    </Grid>
                    <Grid controls:PageSelector.ContentIdentifier="Interaction/Speed">
                        <StackPanel>
                            <DockPanel Margin="4" ToolTip="Minimum and maximum speed of the Launch.">
                                <TextBlock Style="{StaticResource SettingName}" Text="Speed"/>
                                <TextBlock Style="{StaticResource SettingValue}">
                                    <TextBlock.Text>
                                        <MultiBinding StringFormat="{}{0} - {1}">
                                            <Binding Path="Settings.MinSpeed"/>
                                            <Binding Path="Settings.MaxSpeed"/>
                                        </MultiBinding>
                                    </TextBlock.Text>
                                </TextBlock>
                                <shared:RangeSlider Margin="0,4" Minimum="0" Maximum="99" LowerValue="{Binding Settings.MinSpeed, Mode=TwoWay}" UpperValue="{Binding Settings.MaxSpeed, Mode=TwoWay}"/>
                            </DockPanel>

                            <DockPanel Margin="4" ToolTip="Static multiplier that is applied after the automatic speed detection.">
                                <TextBlock Style="{StaticResource SettingName}" Text="Speed Multiplier"/>
                                <TextBlock Style="{StaticResource SettingValue}" Text="{Binding Settings.SpeedMultiplier, StringFormat={}x{0:f1}}"/>
                                <Slider Margin="0,4" Minimum="0.5" Maximum="2.0" Value="{Binding Settings.SpeedMultiplier}"/>
                            </DockPanel>
                        </StackPanel>
                    </Grid>
                    <Grid controls:PageSelector.ContentIdentifier="Interaction/Timings">
                        <StackPanel>
                                <CheckBox IsChecked="{Binding Settings.AutoSkip}" Content="Auto-skip gaps"/>

                                <DockPanel Margin="4" ToolTip="Timespan by which every script command will be delayed. Negative values will cause the commands to be executed ahead of time.">
                                    <TextBlock Style="{StaticResource SettingName}" Text="Script Delay"/>
                                    <TextBlock Style="{StaticResource SettingValue}" Text="{Binding Path=Settings.ScriptDelay, Converter={StaticResource MillisecondsConverter}, StringFormat={}{0:f0} ms}"/>
                                    <Slider Value="{Binding Path=Settings.ScriptDelay, Converter={StaticResource MillisecondsConverter}}" Margin="0,4" Minimum="-500" Maximum="500" SmallChange="25" LargeChange="100"/>
                                </DockPanel>

                                <DockPanel Margin="4" ToolTip="Minimal delay between two script commands">
                                    <TextBlock Style="{StaticResource SettingName}" Text="Min Command Delay"/>
                                    <TextBlock Style="{StaticResource SettingValue}" Text="{Binding Path=Settings.CommandDelay, Converter={StaticResource MillisecondsConverter}, StringFormat={}{0:f0} ms}"/>
                                    <Slider LargeChange="1" Margin="0,4" Minimum="100" Maximum="300"  Value="{Binding Path=Settings.CommandDelay, Converter={StaticResource MillisecondsConverter}}"  SmallChange="1"/>
                                </DockPanel>
                            </StackPanel>
                    </Grid>
                    <Grid controls:PageSelector.ContentIdentifier="Paths">
                        <ListBox Margin="10,10,10,38" ItemsSource="{Binding Settings.AdditionalPaths}"/>

                        <Button Content="+" HorizontalAlignment="Right" VerticalAlignment="Bottom" Margin="0,0,38,10" Width="23" Click="BtnAddPath_Click" Height="23"/>
                        <Button Content="-" HorizontalAlignment="Right" VerticalAlignment="Bottom" Margin="0,0,10,10" Width="23" Click="BtnRemovePath_Click" Height="23"/>
                        <TextBox Height="23" Margin="10,0,66,10" TextWrapping="Wrap" Text="{Binding AdditionalPath}" VerticalAlignment="Bottom" RenderTransformOrigin="0.275,0.739"/>
                    </Grid>
                    <Grid controls:PageSelector.ContentIdentifier="Playlist">
                        <StackPanel>
                            <CheckBox Margin="4" Content="Remember" IsChecked="{Binding Settings.RememberPlaylist}"/>
                            <CheckBox Margin="4" Content="Shuffle" IsChecked="{Binding Settings.ShufflePlaylist}"/>
                            <CheckBox Margin="4" Content="Repeat" IsChecked="{Binding Settings.RepeatPlaylist}"/>
                        </StackPanel>
                    </Grid>
                </controls:PageSelector.Elements>
            </controls:PageSelector>
            <TextBlock Grid.Column="2" HorizontalAlignment="Left" Margin="0,10,0,0" TextWrapping="Wrap" Text="{Binding SettingsTitle}" VerticalAlignment="Top" Width="414"/>
        </Grid>

        <Grid Grid.Column="0" Grid.Row="1" Background="LightGray">
            <Button Content="Ok" Click="BtnOk_OnClick" IsDefault="True" HorizontalAlignment="Right" Margin="0,10,90,10" VerticalAlignment="Bottom" Width="75"/>
            <Button Content="Cancel" IsCancel="True" HorizontalAlignment="Right" Margin="0,10,10,10" VerticalAlignment="Bottom" Width="75"/>
        </Grid>
    </Grid>
</Window>
